<!DOCTYPE html>
<html>
<head>
    <title>–£—Ö–æ–¥ –∑–∞ –∫–æ–º–Ω–∞—Ç–Ω—ã–º–∏ —Ä–∞—Å—Ç–µ–Ω–∏—è–º–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="{{ 'dark-theme' if session.theme == 'dark' else '' }}">
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav">
            <a href="/" class="logo">HealthyPlant</a>
            <div class="nav-buttons">
                {% if session.user_id %}
                    <span class="nav-username">–ü—Ä–∏–≤–µ—Ç, {{ session.username }}!</span>
                    <a href="{{ url_for('my_account') }}" class="button button-outline">üë§ –ú–æ–π –∞–∫–∫–∞—É–Ω—Ç</a>
                    <button class="theme-toggle" onclick="toggleTheme()">
                        {% if session.theme == 'dark' %}‚òÄÔ∏è{% else %}üåô{% endif %}
                    </button>
                    <button class="button button-outline" onclick="logout()">–í—ã–π—Ç–∏</button>
                {% else %}
                    <button class="theme-toggle" onclick="toggleTheme()">
                        {% if session.theme == 'dark' %}‚òÄÔ∏è{% else %}üåô{% endif %}
                    </button>
                    <button class="button button-outline" onclick="openModal('loginModal')">–í–æ–π—Ç–∏</button>
                    <button class="button" onclick="openModal('registerModal')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                {% endif %}
            </div>
        </div>

        {% if request.endpoint == 'my_account' %}
            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
            <div class="section">
                <h1>üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                <div class="account-section">
                    <div class="account-sidebar">
                        <h3>–ú–µ–Ω—é</h3>
                        <ul class="sidebar-menu">
                            <li><a href="#profile" class="active" onclick="showSection('profile')">üìä –ü—Ä–æ—Ñ–∏–ª—å</a></li>
                            <li><a href="#my-flowers" onclick="showSection('my-flowers')">üå∫ –ú–æ–∏ —Ü–≤–µ—Ç—ã</a></li>
                            <li><a href="#settings" onclick="showSection('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
                        </ul>
                    </div>

                    <div class="account-content">
                        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
                        <div id="profile-section" class="account-section-content">
                            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</h2>
                            <div class="user-info">
                                <h3>{{ session.username }}</h3>
                                <p>Email: {{ session.email }}</p>
                                <div class="user-stats">
                                    <div class="stat-item">
                                        <div class="stat-number">{{ user_data.analysis_count if user_data else 0 }}</div>
                                        <div>–ê–Ω–∞–ª–∏–∑–æ–≤</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">{{ user_data.flowers|length if user_data and user_data.flowers else 0 }}</div>
                                        <div>–¶–≤–µ—Ç–∫–æ–≤</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">{{ user_data.created_at[:10] if user_data and user_data.created_at else '' }}</div>
                                        <div>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ú–æ–∏ —Ü–≤–µ—Ç—ã -->
                        <div id="my-flowers-section" class="account-section-content" style="display: none;">
                            <h2>üå∫ –ú–æ–∏ —Ü–≤–µ—Ç—ã</h2>
                            {% if user_flowers %}
                            <div class="my-flowers-grid">
                                {% for flower in user_flowers %}
                                <div class="flower-card">
                                    {% if get_flower_image_url %}
                                        {% set flower_image = get_flower_image_url(flower.image_filename) %}
                                        {% if flower_image %}
                                        <img src="{{ flower_image }}" alt="{{ flower.name }}">
                                        {% endif %}
                                    {% endif %}
                                    <h3>{{ flower.name }}</h3>
                                    <p><strong>–¢–∏–ø:</strong> {{ flower.type }}</p>
                                    <p><strong>–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:</strong> {{ flower.analysis_date[:10] }}</p>
                                    <div class="care-details">
                                        <h4>–£—Ö–æ–¥:</h4>
                                        <p><strong>–ü–æ–ª–∏–≤:</strong> {{ flower.care.watering }}</p>
                                        <p><strong>–û—Å–≤–µ—â–µ–Ω–∏–µ:</strong> {{ flower.care.light }}</p>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–∫–æ–≤.</p>
                            <a href="/" class="button">üîç –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤—ã–π —Ü–≤–µ—Ç–æ–∫</a>
                            {% endif %}
                        </div>

                        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                        <div id="settings-section" class="account-section-content" style="display: none;">
                            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                            <div class="form-group">
                                <label class="form-label">–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                                <div>
                                    <button class="button {{ 'button-outline' if session.theme != 'light' else '' }}" onclick="changeTheme('light')">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</button>
                                    <button class="button {{ 'button-outline' if session.theme != 'dark' else '' }}" onclick="changeTheme('dark')">üåô –¢—ë–º–Ω–∞—è</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
            <div class="hero section">
                <h1>üåø –£—Ö–æ–¥ –∑–∞ –∫–æ–º–Ω–∞—Ç–Ω—ã–º–∏ —Ä–∞—Å—Ç–µ–Ω–∏—è–º–∏</h1>
                <p class="hero-description">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—Ö–æ–¥ –∑–∞ —Ü–≤–µ—Ç–∞–º–∏ –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –ø–æ–ª–∏–≤, –ø–æ–¥–∫–æ—Ä–º–∫—É –∏ –ª—é–±–æ–≤—å –∫ —Ä–∞—Å—Ç–µ–Ω–∏—è–º.</p>

                {% if session.user_id %}
                <div class="user-info">
                    <h3>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ session.username }}!</h3>
                    <div class="user-stats">
                        <div class="stat-item">
                            <div class="stat-number">{{ user_data.analysis_count if user_data else 0 }}</div>
                            <div>–ê–Ω–∞–ª–∏–∑–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ user_data.flowers|length if user_data and user_data.flowers else 0 }}</div>
                            <div>–¶–≤–µ—Ç–∫–æ–≤</div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <a href="#upload" class="button">üîç –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ü–≤–µ—Ç–æ–∫ –ø–æ —Ñ–æ—Ç–æ</a>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            {% if session.user_id %}
            <div class="section" id="upload">
                <h2>üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —Ü–≤–µ—Ç–∫–∞</h2>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –≤–∞—à–µ–≥–æ –∫–æ–º–Ω–∞—Ç–Ω–æ–≥–æ —Ä–∞—Å—Ç–µ–Ω–∏—è, –∏ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–º –µ–≥–æ —Ç–∏–ø –∏ –¥–∞–¥–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Ö–æ–¥—É.</p>

                <form method="POST" enctype="multipart/form-data" class="upload-section">
                    <input type="file" name="flower_image" id="flowerImage" accept="image/*" style="display: none;" onchange="previewImage()">
                    <label for="flowerImage" class="button">
                        üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
                    </label>
                    <div id="imagePreview" class="image-preview"></div>
                    <button type="submit" class="button analyze-button">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–æ–∫</button>
                </form>
            </div>

            {% if flower_data %}
            <div class="flower-result section" id="flowerResult">
                <h2>üå∫ –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞</h2>
                <div class="flower-info">
                    <div class="flower-image-container">
                        {% if flower_image %}
                        <img src="{{ flower_image }}" alt="{{ flower_data.name }}" class="flower-image">
                        {% endif %}
                    </div>
                    <div class="flower-details">
                        <h3>{{ flower_data.name }}</h3>
                        <p><strong>–¢–∏–ø:</strong> {{ flower_data.type }}</p>
                        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ flower_data.description }}</p>

                        <div class="care-details">
                            <h4>üíß –£—Ö–æ–¥ –∑–∞ —Ä–∞—Å—Ç–µ–Ω–∏–µ–º:</h4>
                            <ul>
                                <li><strong>–ü–æ–ª–∏–≤:</strong> {{ flower_data.care.watering }}</li>
                                <li><strong>–û—Å–≤–µ—â–µ–Ω–∏–µ:</strong> {{ flower_data.care.light }}</li>
                                <li><strong>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</strong> {{ flower_data.care.temperature }}</li>
                                <li><strong>–í–ª–∞–∂–Ω–æ—Å—Ç—å:</strong> {{ flower_data.care.humidity }}</li>
                                <li><strong>–£–¥–æ–±—Ä–µ–Ω–∏–µ:</strong> {{ flower_data.care.fertilizer }}</li>
                            </ul>
                        </div>

                        <div class="problem-list">
                            <h4>‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:</h4>
                            <ul>
                                {% for problem in flower_data.problems %}
                                <li>{{ problem }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            {% else %}
            <div class="section auth-required-section">
                <h2>üîê –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                <p>–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ü–≤–µ—Ç–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è.</p>
                <div class="auth-buttons">
                    <button class="button" onclick="openModal('registerModal')">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    <button class="button button-outline" onclick="openModal('loginModal')">–í–æ–π—Ç–∏</button>
                </div>
            </div>
            {% endif %}

            <div class="section">
                <h2>üìù –°–æ–≤–µ—Ç—ã –ø–æ —É—Ö–æ–¥—É –∑–∞ —Ä–∞—Å—Ç–µ–Ω–∏—è–º–∏</h2>
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üíß</div>
                        <h3>–ü–æ–ª–∏–≤</h3>
                        <p>–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—á–≤—ã. –ù–µ –¥–æ–ø—É—Å–∫–∞–π—Ç–µ –ø–µ—Ä–µ—Å—ã—Ö–∞–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ—É–≤–ª–∞–∂–Ω–µ–Ω–∏—è.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚òÄÔ∏è</div>
                        <h3>–û—Å–≤–µ—â–µ–Ω–∏–µ</h3>
                        <p>–û–±–µ—Å–ø–µ—á—å—Ç–µ —Ä–∞—Å—Ç–µ–Ω–∏—è–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–µ—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∏—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üå°Ô∏è</div>
                        <h3>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</h3>
                        <p>–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–º —Ä–µ–∂–∏–º–æ–º, –∏–∑–±–µ–≥–∞–π—Ç–µ —Ä–µ–∑–∫–∏—Ö –ø–µ—Ä–µ–ø–∞–¥–æ–≤.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üçÉ</div>
                        <h3>–ì–∏–≥–∏–µ–Ω–∞</h3>
                        <p>–†–µ–≥—É–ª—è—Ä–Ω–æ —É–¥–∞–ª—è–π—Ç–µ –ø—ã–ª—å —Å –ª–∏—Å—Ç—å–µ–≤ –∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤—Ä–µ–¥–∏—Ç–µ–ª–µ–π.</p>
                    </div>
                </div>
            </div>

            <div class="section" id="contact">
                <h2>üìû –°–≤—è–∑–∞—Ç—å—Å—è</h2>
                <p>üìß Email: healthyplant7@gmail.com</p>
            </div>
        {% endif %}
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
            <h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <form method="POST" action="{{ url_for('register') }}">
                <div class="form-group">
                    <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" name="username" class="form-input" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" name="email" class="form-input" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email">
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" name="password" class="form-input" required placeholder="–°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
                    <input type="password" name="confirm_password" class="form-input" required placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                    <select name="theme" class="form-input">
                        <option value="light">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</option>
                        <option value="dark">üåô –¢—ë–º–Ω–∞—è</option>
                    </select>
                </div>
                <button type="submit" class="button modal-submit-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </form>
            <p class="modal-footer">
                –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="closeModal('registerModal'); openModal('loginModal');">–í–æ–π–¥–∏—Ç–µ</a>
            </p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2>üîë –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
            <form method="POST" action="{{ url_for('login') }}">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" name="email" class="form-input" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email">
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" name="password" class="form-input" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å">
                </div>
                <button type="submit" class="button modal-submit-btn">–í–æ–π—Ç–∏</button>
            </form>
            <p class="modal-footer">
                –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="closeModal('loginModal'); openModal('registerModal');">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>
            </p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
